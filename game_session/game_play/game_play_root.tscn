[gd_scene load_steps=27 format=3 uid="uid://dn24y8eq6bsf"]

[ext_resource type="Script" path="res://game_session/game_play/game_play_root.gd" id="1_kicvc"]
[ext_resource type="Script" path="res://game_session/game_play/play_phase_state_machine.gd" id="4_rxnh7"]
[ext_resource type="Script" path="res://game_session/game_play/movement/movement_phase.gd" id="5_qyd0w"]
[ext_resource type="Script" path="res://game_session/game_play/movement/movement_phase_machine.gd" id="6_rh5ps"]
[ext_resource type="Script" path="res://game_session/game_play/movement/choose_unit_for_move.gd" id="7_77m47"]
[ext_resource type="Script" path="res://game_session/game_play/movement/choose_unit_destination.gd" id="8_gsitl"]
[ext_resource type="Script" path="res://game_session/game_play/combat/combat_phase.gd" id="9_l5y64"]
[ext_resource type="Script" path="res://game_session/game_play/combat/combat_phase_machine.gd" id="10_cw3gt"]
[ext_resource type="Script" path="res://game_session/game_play/combat/main_combat_subphase.gd" id="11_72puf"]
[ext_resource type="Script" path="res://game_session/game_play/combat/choose_units_for_attack.gd" id="12_bclrs"]
[ext_resource type="Script" path="res://game_session/game_play/combat/choose_defender_for_attack.gd" id="13_73w2u"]
[ext_resource type="Script" path="res://game_session/game_play/combat/resolve_combat.gd" id="14_kp63i"]
[ext_resource type="Script" path="res://game_session/game_play/combat/allocate_exchange_losses.gd" id="15_nensy"]
[ext_resource type="Script" path="res://game_session/game_play/combat/choose_attacker_to_retreat.gd" id="16_vqded"]
[ext_resource type="Script" path="res://game_session/game_play/combat/retreat_attacker.gd" id="17_buyt2"]
[ext_resource type="Script" path="res://game_session/game_play/combat/make_way_for_retreat.gd" id="17_rmqba"]
[ext_resource type="Script" path="res://game_session/game_play/combat/retreat_defender.gd" id="18_1m6pe"]
[ext_resource type="Script" path="res://game_session/game_play/combat/choose_ally_to_make_way.gd" id="18_ohqr4"]
[ext_resource type="Script" path="res://game_session/game_play/combat/pursue_retreating_defender.gd" id="19_l7c67"]
[ext_resource type="Script" path="res://addons/godot_state_charts/state_chart.gd" id="20_qywoi"]
[ext_resource type="Script" path="res://addons/godot_state_charts/parallel_state.gd" id="21_i6w5i"]
[ext_resource type="Script" path="res://addons/godot_state_charts/compound_state.gd" id="22_07qe0"]
[ext_resource type="Script" path="res://addons/godot_state_charts/transition.gd" id="23_hxj8n"]
[ext_resource type="Script" path="res://addons/godot_state_charts/atomic_state.gd" id="24_uvwcr"]
[ext_resource type="Script" path="res://addons/godot_state_charts/history_state.gd" id="25_kms61"]
[ext_resource type="PackedScene" uid="uid://bcwkugn6v3oy7" path="res://addons/godot_state_charts/utilities/state_chart_debugger.tscn" id="26_5lf1w"]

[node name="GamePlayRoot" type="Control" node_paths=PackedStringArray("state_chart")]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
script = ExtResource("1_kicvc")
state_chart = NodePath("StateChart")

[node name="TopMargin" type="MarginContainer" parent="."]
layout_mode = 1
anchors_preset = 5
anchor_left = 0.5
anchor_right = 0.5
offset_left = -192.0
offset_right = 192.0
offset_bottom = 268.0
grow_horizontal = 2
theme_override_constants/margin_top = 20

[node name="Panel" type="PanelContainer" parent="TopMargin"]
layout_mode = 2
size_flags_vertical = 0

[node name="Margins" type="MarginContainer" parent="TopMargin/Panel"]
layout_mode = 2
theme_override_constants/margin_left = 10
theme_override_constants/margin_top = 10
theme_override_constants/margin_right = 10
theme_override_constants/margin_bottom = 10

[node name="HBox" type="HBoxContainer" parent="TopMargin/Panel/Margins"]
layout_mode = 2

[node name="VBox" type="VBoxContainer" parent="TopMargin/Panel/Margins/HBox"]
layout_mode = 2
size_flags_horizontal = 3
theme_override_constants/separation = 10

[node name="Turn" type="Label" parent="TopMargin/Panel/Margins/HBox/VBox"]
unique_name_in_owner = true
layout_mode = 2
text = "Turn: 1"
horizontal_alignment = 1

[node name="OrfburgCurrentPlayer" type="Label" parent="TopMargin/Panel/Margins/HBox/VBox"]
unique_name_in_owner = true
visible = false
layout_mode = 2
text = "Current Player: Orfburg"

[node name="WulfenburgCurrentPlayer" type="Label" parent="TopMargin/Panel/Margins/HBox/VBox"]
unique_name_in_owner = true
visible = false
layout_mode = 2
text = "Current Player: Wulfenburg"

[node name="MovementPhase" type="Label" parent="TopMargin/Panel/Margins/HBox/VBox"]
unique_name_in_owner = true
visible = false
layout_mode = 2
text = "Movement Phase"
horizontal_alignment = 1

[node name="CombatPhase" type="Label" parent="TopMargin/Panel/Margins/HBox/VBox"]
unique_name_in_owner = true
visible = false
layout_mode = 2
text = "Combat Phase"
horizontal_alignment = 1

[node name="SubPhaseInstruction" type="Label" parent="TopMargin/Panel/Margins/HBox/VBox"]
unique_name_in_owner = true
layout_mode = 2
text = "Choose a unit to move"

[node name="RemainingStrengthToAllocate" type="Label" parent="TopMargin/Panel/Margins/HBox/VBox"]
unique_name_in_owner = true
visible = false
layout_mode = 2
text = "(remaining strength to allocate)"

[node name="BottomLeftMargin" type="MarginContainer" parent="."]
layout_mode = 1
anchors_preset = 2
anchor_top = 1.0
anchor_bottom = 1.0
offset_top = -869.0
offset_right = 546.0
grow_vertical = 0
mouse_filter = 2
theme_override_constants/margin_left = 10
theme_override_constants/margin_bottom = 10

[node name="HBoxContainer" type="HBoxContainer" parent="BottomLeftMargin"]
layout_mode = 2
mouse_filter = 2

[node name="VBox" type="VBoxContainer" parent="BottomLeftMargin/HBoxContainer"]
layout_mode = 2
size_flags_horizontal = 3
mouse_filter = 2
alignment = 2

[node name="Panel" type="PanelContainer" parent="BottomLeftMargin/HBoxContainer/VBox"]
custom_minimum_size = Vector2(0, 800)
layout_mode = 2
size_flags_vertical = 3
mouse_filter = 2

[node name="Margin" type="MarginContainer" parent="BottomLeftMargin/HBoxContainer/VBox/Panel"]
layout_mode = 2
mouse_filter = 2
theme_override_constants/margin_left = 10
theme_override_constants/margin_top = 10
theme_override_constants/margin_right = 10
theme_override_constants/margin_bottom = 10

[node name="VBox" type="VBoxContainer" parent="BottomLeftMargin/HBoxContainer/VBox/Panel/Margin"]
layout_mode = 2
mouse_filter = 2

[node name="ScrollContainer" type="ScrollContainer" parent="BottomLeftMargin/HBoxContainer/VBox/Panel/Margin/VBox"]
layout_mode = 2
size_flags_vertical = 3
horizontal_scroll_mode = 0

[node name="PhaseInstruction" type="Label" parent="BottomLeftMargin/HBoxContainer/VBox/Panel/Margin/VBox/ScrollContainer"]
unique_name_in_owner = true
layout_mode = 2
size_flags_horizontal = 3
size_flags_vertical = 6
text = "Each of your units can move once during this phase, and each is limited in the total distance it can move.
This limit is affected by the unit type, as well as the terrain you make your units cross.
Mounted units (Cavalry and Dukes) start each turn with 6 movement points.
Units on foot (Infantry and Artillery) start each turn with 3 movement points.
Any movement points not spent are lost at the end of the Movement Phase.
The cost in movement points to enter a tile depends on the terrain on that tile, as well as any features on its border with the tile from which a piece is leaving.
Roads cost 1/2 points to cross.
Cities cost 1/2 points to enter.
Bridges cost 1 point to cross (but only 1/2 points if a Road crosses the Bridge as well).
Plains cost 1 point to enter.
Woods and Cliffs cost 2 points to enter.
Lakes can not be entered.
Rivers can not be crossed (but a Bridge over a River can be crossed - cost as specified above).
"
autowrap_mode = 3

[node name="ToggleInstructions" type="Button" parent="BottomLeftMargin/HBoxContainer/VBox"]
layout_mode = 2
toggle_mode = true
button_pressed = true
text = "View Instructions"

[node name="BottomRightMargin" type="MarginContainer" parent="."]
layout_mode = 1
anchors_preset = 3
anchor_left = 1.0
anchor_top = 1.0
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = -175.0
offset_top = -61.0
grow_horizontal = 0
grow_vertical = 0
theme_override_constants/margin_right = 10
theme_override_constants/margin_bottom = 10

[node name="HBox" type="HBoxContainer" parent="BottomRightMargin"]
layout_mode = 2

[node name="Cancel" type="HBoxContainer" parent="BottomRightMargin/HBox"]
layout_mode = 2

[node name="CancelMoverChoice" type="Button" parent="BottomRightMargin/HBox/Cancel"]
unique_name_in_owner = true
visible = false
layout_mode = 2
text = "Cancel Unit Choice"

[node name="CancelAttack" type="Button" parent="BottomRightMargin/HBox/Cancel"]
unique_name_in_owner = true
visible = false
layout_mode = 2
text = "Cancel Attack"

[node name="ChangeAttackers" type="Button" parent="BottomRightMargin/HBox/Cancel"]
unique_name_in_owner = true
visible = false
layout_mode = 2
text = "Change Attackers"

[node name="ChangeAttackerForRetreat" type="Button" parent="BottomRightMargin/HBox/Cancel"]
unique_name_in_owner = true
visible = false
layout_mode = 2
text = "Choose A Different Attacker To Retreat"

[node name="UnitChosenToMakeWay" type="Button" parent="BottomRightMargin/HBox/Cancel"]
unique_name_in_owner = true
visible = false
layout_mode = 2
text = "Choose A Different Ally To Make Way"

[node name="CancelPursuit" type="Button" parent="BottomRightMargin/HBox/Cancel"]
unique_name_in_owner = true
visible = false
layout_mode = 2
text = "Don't Pursue"

[node name="Confirm" type="HBoxContainer" parent="BottomRightMargin/HBox"]
layout_mode = 2

[node name="EndMovementPhase" type="Button" parent="BottomRightMargin/HBox/Confirm"]
unique_name_in_owner = true
visible = false
layout_mode = 2
text = "End Movement Phase"

[node name="EndCombatPhase" type="Button" parent="BottomRightMargin/HBox/Confirm"]
unique_name_in_owner = true
visible = false
layout_mode = 2
text = "End Combat Phase"

[node name="ConfirmAttackers" type="Button" parent="BottomRightMargin/HBox/Confirm"]
unique_name_in_owner = true
visible = false
layout_mode = 2
text = "Choose Defender"

[node name="ConfirmDefender" type="Button" parent="BottomRightMargin/HBox/Confirm"]
unique_name_in_owner = true
visible = false
layout_mode = 2
text = "Confirm Defender"

[node name="ConfirmCombatResult" type="Button" parent="BottomRightMargin/HBox/Confirm"]
unique_name_in_owner = true
visible = false
layout_mode = 2
text = "Ok"

[node name="ConfirmLossAllocation" type="Button" parent="BottomRightMargin/HBox/Confirm"]
unique_name_in_owner = true
visible = false
layout_mode = 2
text = "Confirm Loss Allocation"

[node name="PlayStateMachine" type="Node" parent="." node_paths=PackedStringArray("current_phase")]
script = ExtResource("4_rxnh7")
current_phase = NodePath("MovementPhase")

[node name="MovementPhase" type="Node" parent="PlayStateMachine" node_paths=PackedStringArray("move_phase_machine", "combat_phase", "choose_unit")]
script = ExtResource("5_qyd0w")
move_phase_machine = NodePath("MovementPhaseStateMachine")
combat_phase = NodePath("../CombatPhase")
choose_unit = NodePath("MovementPhaseStateMachine/ChooseUnitForMove")

[node name="MovementPhaseStateMachine" type="Node" parent="PlayStateMachine/MovementPhase"]
script = ExtResource("6_rh5ps")

[node name="ChooseUnitForMove" type="Node" parent="PlayStateMachine/MovementPhase/MovementPhaseStateMachine" node_paths=PackedStringArray("parent_phase", "choose_destination")]
script = ExtResource("7_77m47")
parent_phase = NodePath("../..")
choose_destination = NodePath("../ChooseUnitDestination")

[node name="ChooseUnitDestination" type="Node" parent="PlayStateMachine/MovementPhase/MovementPhaseStateMachine" node_paths=PackedStringArray("choose_unit", "parent_phase")]
script = ExtResource("8_gsitl")
choose_unit = NodePath("../ChooseUnitForMove")
parent_phase = NodePath("../..")

[node name="CombatPhase" type="Node" parent="PlayStateMachine" node_paths=PackedStringArray("combat_phase_machine", "move_phase", "main_combat", "choose_attackers")]
script = ExtResource("9_l5y64")
combat_phase_machine = NodePath("CombatPhaseStateMachine")
move_phase = NodePath("../MovementPhase")
main_combat = NodePath("CombatPhaseStateMachine/MainCombatSubphase")
choose_attackers = NodePath("CombatPhaseStateMachine/ChooseUnitsForAttack")

[node name="CombatPhaseStateMachine" type="Node" parent="PlayStateMachine/CombatPhase"]
script = ExtResource("10_cw3gt")

[node name="MainCombatSubphase" type="Node" parent="PlayStateMachine/CombatPhase/CombatPhaseStateMachine" node_paths=PackedStringArray("parent_phase", "choose_attackers")]
script = ExtResource("11_72puf")
parent_phase = NodePath("../..")
choose_attackers = NodePath("../ChooseUnitsForAttack")

[node name="ChooseUnitsForAttack" type="Node" parent="PlayStateMachine/CombatPhase/CombatPhaseStateMachine" node_paths=PackedStringArray("parent_phase", "main_combat", "choose_defender")]
script = ExtResource("12_bclrs")
parent_phase = NodePath("../..")
main_combat = NodePath("../MainCombatSubphase")
choose_defender = NodePath("../ChooseDefenderForAttack")

[node name="ChooseDefenderForAttack" type="Node" parent="PlayStateMachine/CombatPhase/CombatPhaseStateMachine" node_paths=PackedStringArray("parent_phase", "main_subphase", "choose_attackers", "resolve_combat")]
script = ExtResource("13_73w2u")
parent_phase = NodePath("../..")
main_subphase = NodePath("../MainCombatSubphase")
choose_attackers = NodePath("../ChooseUnitsForAttack")
resolve_combat = NodePath("../ResolveCombat")

[node name="ResolveCombat" type="Node" parent="PlayStateMachine/CombatPhase/CombatPhaseStateMachine" node_paths=PackedStringArray("parent_phase", "phase_state_machine", "main_combat", "choose_attackers", "choose_defender", "allocate_exchange_losses", "choose_attacker_to_retreat", "choose_ally_to_make_way", "retreat_defender")]
script = ExtResource("14_kp63i")
parent_phase = NodePath("../..")
phase_state_machine = NodePath("..")
main_combat = NodePath("../MainCombatSubphase")
choose_attackers = NodePath("../ChooseUnitsForAttack")
choose_defender = NodePath("../ChooseDefenderForAttack")
allocate_exchange_losses = NodePath("../AllocateExchangeLosses")
choose_attacker_to_retreat = NodePath("../ChooseAttackerToRetreat")
choose_ally_to_make_way = NodePath("../ChooseAllyToMakeWay")
retreat_defender = NodePath("../RetreatDefender")

[node name="AllocateExchangeLosses" type="Node" parent="PlayStateMachine/CombatPhase/CombatPhaseStateMachine" node_paths=PackedStringArray("parent_phase", "main_combat", "choose_attackers", "choose_defender")]
script = ExtResource("15_nensy")
parent_phase = NodePath("../..")
main_combat = NodePath("../MainCombatSubphase")
choose_attackers = NodePath("../ChooseUnitsForAttack")
choose_defender = NodePath("../ChooseDefenderForAttack")

[node name="ChooseAttackerToRetreat" type="Node" parent="PlayStateMachine/CombatPhase/CombatPhaseStateMachine" node_paths=PackedStringArray("parent_phase", "main_combat", "choose_attackers", "retreat_attacker", "choose_ally_to_make_way")]
script = ExtResource("16_vqded")
parent_phase = NodePath("../..")
main_combat = NodePath("../MainCombatSubphase")
choose_attackers = NodePath("../ChooseUnitsForAttack")
retreat_attacker = NodePath("../RetreatAttacker")
choose_ally_to_make_way = NodePath("../ChooseAllyToMakeWay")

[node name="RetreatAttacker" type="Node" parent="PlayStateMachine/CombatPhase/CombatPhaseStateMachine" node_paths=PackedStringArray("parent_phase", "main_combat", "choose_retreater", "choose_ally_to_make_way")]
script = ExtResource("17_buyt2")
parent_phase = NodePath("../..")
main_combat = NodePath("../MainCombatSubphase")
choose_retreater = NodePath("../ChooseAttackerToRetreat")
choose_ally_to_make_way = NodePath("../ChooseAllyToMakeWay")

[node name="ChooseAllyToMakeWay" type="Node" parent="PlayStateMachine/CombatPhase/CombatPhaseStateMachine" node_paths=PackedStringArray("parent_phase", "make_way")]
script = ExtResource("18_ohqr4")
parent_phase = NodePath("../..")
make_way = NodePath("../MakeWayForRetreat")

[node name="MakeWayForRetreat" type="Node" parent="PlayStateMachine/CombatPhase/CombatPhaseStateMachine" node_paths=PackedStringArray("parent_phase", "main_combat", "choose_attackers", "choose_ally_to_make_way", "choose_attacker_to_pursue")]
script = ExtResource("17_rmqba")
parent_phase = NodePath("../..")
main_combat = NodePath("../MainCombatSubphase")
choose_attackers = NodePath("../ChooseUnitsForAttack")
choose_ally_to_make_way = NodePath("../ChooseAllyToMakeWay")
choose_attacker_to_pursue = NodePath("../ChooseAttackerToPursueRetreatingDefender")

[node name="ChooseAttackerToPursueRetreatingDefender" type="Node" parent="PlayStateMachine/CombatPhase/CombatPhaseStateMachine" node_paths=PackedStringArray("phase_state_machine", "main_combat")]
script = ExtResource("19_l7c67")
phase_state_machine = NodePath("..")
main_combat = NodePath("../MainCombatSubphase")

[node name="RetreatDefender" type="Node" parent="PlayStateMachine/CombatPhase/CombatPhaseStateMachine" node_paths=PackedStringArray("parent_phase", "main_combat", "choose_attackers", "choose_defender", "choose_ally_to_make_way", "choose_attacker_to_pursue")]
script = ExtResource("18_1m6pe")
parent_phase = NodePath("../..")
main_combat = NodePath("../MainCombatSubphase")
choose_attackers = NodePath("../ChooseUnitsForAttack")
choose_defender = NodePath("../ChooseDefenderForAttack")
choose_ally_to_make_way = NodePath("../ChooseAllyToMakeWay")
choose_attacker_to_pursue = NodePath("../ChooseAttackerToPursueRetreatingDefender")

[node name="StateChart" type="Node" parent="."]
script = ExtResource("20_qywoi")

[node name="ParallelState" type="Node" parent="StateChart"]
script = ExtResource("21_i6w5i")

[node name="Player" type="Node" parent="StateChart/ParallelState"]
script = ExtResource("22_07qe0")
initial_state = NodePath("Player 1")

[node name="Player 1" type="Node" parent="StateChart/ParallelState/Player"]
script = ExtResource("24_uvwcr")

[node name="to player 2" type="Node" parent="StateChart/ParallelState/Player/Player 1"]
script = ExtResource("23_hxj8n")
to = NodePath("../../Player 2")
event = &"end combat"

[node name="Player 2" type="Node" parent="StateChart/ParallelState/Player"]
script = ExtResource("24_uvwcr")

[node name="to player 1" type="Node" parent="StateChart/ParallelState/Player/Player 2"]
script = ExtResource("23_hxj8n")
to = NodePath("../../Player 1")
event = &"end combat"

[node name="Phase" type="Node" parent="StateChart/ParallelState"]
script = ExtResource("22_07qe0")
initial_state = NodePath("Movement")

[node name="Movement" type="Node" parent="StateChart/ParallelState/Phase"]
script = ExtResource("22_07qe0")
initial_state = NodePath("Choose Mover")

[node name="to combat" type="Node" parent="StateChart/ParallelState/Phase/Movement"]
script = ExtResource("23_hxj8n")
to = NodePath("../../Combat")
event = &"movement ended"

[node name="Choose Mover" type="Node" parent="StateChart/ParallelState/Phase/Movement"]
script = ExtResource("24_uvwcr")

[node name="choose unit" type="Node" parent="StateChart/ParallelState/Phase/Movement/Choose Mover"]
script = ExtResource("23_hxj8n")
to = NodePath("../../Choose Destination")
event = &"mover chosen"

[node name="Choose Destination" type="Node" parent="StateChart/ParallelState/Phase/Movement"]
script = ExtResource("24_uvwcr")

[node name="choose tile" type="Node" parent="StateChart/ParallelState/Phase/Movement/Choose Destination"]
script = ExtResource("23_hxj8n")
to = NodePath("../../Choose Mover")
event = &"unit moved"

[node name="cancel choice of mover" type="Node" parent="StateChart/ParallelState/Phase/Movement/Choose Destination"]
script = ExtResource("23_hxj8n")
to = NodePath("../../Choose Mover")
event = &"mover choice canceled"

[node name="Combat" type="Node" parent="StateChart/ParallelState/Phase"]
script = ExtResource("22_07qe0")
initial_state = NodePath("Choose Attackers")

[node name="to movement" type="Node" parent="StateChart/ParallelState/Phase/Combat"]
script = ExtResource("23_hxj8n")
to = NodePath("../../Movement")
event = &"end combat"

[node name="Choose Attackers" type="Node" parent="StateChart/ParallelState/Phase/Combat"]
script = ExtResource("24_uvwcr")

[node name="choose defender" type="Node" parent="StateChart/ParallelState/Phase/Combat/Choose Attackers"]
script = ExtResource("23_hxj8n")
to = NodePath("../../Choose Defender")
event = &"attackers chosen"

[node name="Choose Defender" type="Node" parent="StateChart/ParallelState/Phase/Combat"]
script = ExtResource("24_uvwcr")

[node name="resolve combat" type="Node" parent="StateChart/ParallelState/Phase/Combat/Choose Defender"]
script = ExtResource("23_hxj8n")
to = NodePath("../../Resolve Combat")
event = &"defender chosen"

[node name="Resolve Combat" type="Node" parent="StateChart/ParallelState/Phase/Combat"]
script = ExtResource("22_07qe0")
initial_state = NodePath("View Result")

[node name="View Result" type="Node" parent="StateChart/ParallelState/Phase/Combat/Resolve Combat"]
script = ExtResource("24_uvwcr")

[node name="choose next attackers" type="Node" parent="StateChart/ParallelState/Phase/Combat/Resolve Combat/View Result"]
script = ExtResource("23_hxj8n")
to = NodePath("../../../Choose Attackers")
event = &"combat resolved"

[node name="retreat defender" type="Node" parent="StateChart/ParallelState/Phase/Combat/Resolve Combat/View Result"]
script = ExtResource("23_hxj8n")
to = NodePath("../../Retreat Defender")
event = &"defender retreats"

[node name="retreat attackers" type="Node" parent="StateChart/ParallelState/Phase/Combat/Resolve Combat/View Result"]
script = ExtResource("23_hxj8n")
to = NodePath("../../Retreat Attackers")

[node name="exchange" type="Node" parent="StateChart/ParallelState/Phase/Combat/Resolve Combat/View Result"]
script = ExtResource("23_hxj8n")
to = NodePath("../../Exchange")

[node name="Retreat Defender" type="Node" parent="StateChart/ParallelState/Phase/Combat/Resolve Combat"]
script = ExtResource("24_uvwcr")

[node name="choose next attackers" type="Node" parent="StateChart/ParallelState/Phase/Combat/Resolve Combat/Retreat Defender"]
script = ExtResource("23_hxj8n")
to = NodePath("../../../Choose Attackers")
event = &"combat resolved"

[node name="to make way" type="Node" parent="StateChart/ParallelState/Phase/Combat/Resolve Combat/Retreat Defender"]
script = ExtResource("23_hxj8n")
to = NodePath("../../../Make Way")

[node name="Retreat Attackers" type="Node" parent="StateChart/ParallelState/Phase/Combat/Resolve Combat"]
script = ExtResource("22_07qe0")
initial_state = NodePath("Choose Retreater")

[node name="Choose Retreater" type="Node" parent="StateChart/ParallelState/Phase/Combat/Resolve Combat/Retreat Attackers"]
script = ExtResource("24_uvwcr")

[node name="choose destination" type="Node" parent="StateChart/ParallelState/Phase/Combat/Resolve Combat/Retreat Attackers/Choose Retreater"]
script = ExtResource("23_hxj8n")
to = NodePath("../../Choose Destination")

[node name="Choose Destination" type="Node" parent="StateChart/ParallelState/Phase/Combat/Resolve Combat/Retreat Attackers"]
script = ExtResource("24_uvwcr")

[node name="choose next attackers" type="Node" parent="StateChart/ParallelState/Phase/Combat/Resolve Combat/Retreat Attackers/Choose Destination"]
script = ExtResource("23_hxj8n")
to = NodePath("../../../../Choose Attackers")

[node name="choose next retreater" type="Node" parent="StateChart/ParallelState/Phase/Combat/Resolve Combat/Retreat Attackers/Choose Destination"]
script = ExtResource("23_hxj8n")
to = NodePath("../../Choose Retreater")
event = &"combat resolved"

[node name="to make way" type="Node" parent="StateChart/ParallelState/Phase/Combat/Resolve Combat/Retreat Attackers/Choose Destination"]
script = ExtResource("23_hxj8n")
to = NodePath("../../../../Make Way")

[node name="Resume Retreat" type="Node" parent="StateChart/ParallelState/Phase/Combat/Resolve Combat"]
script = ExtResource("25_kms61")
default_state = NodePath("../Retreat Defender")

[node name="Exchange" type="Node" parent="StateChart/ParallelState/Phase/Combat/Resolve Combat"]
script = ExtResource("24_uvwcr")

[node name="choose next attackers" type="Node" parent="StateChart/ParallelState/Phase/Combat/Resolve Combat/Exchange"]
script = ExtResource("23_hxj8n")
to = NodePath("../../../Choose Attackers")
event = &"combat resolved"

[node name="Make Way" type="Node" parent="StateChart/ParallelState/Phase/Combat"]
script = ExtResource("22_07qe0")
initial_state = NodePath("Choose Ally")

[node name="Choose Ally" type="Node" parent="StateChart/ParallelState/Phase/Combat/Make Way"]
script = ExtResource("24_uvwcr")

[node name="choose destination" type="Node" parent="StateChart/ParallelState/Phase/Combat/Make Way/Choose Ally"]
script = ExtResource("23_hxj8n")
to = NodePath("../../Choose Destination")

[node name="Choose Destination" type="Node" parent="StateChart/ParallelState/Phase/Combat/Make Way"]
script = ExtResource("24_uvwcr")

[node name="resume retreat" type="Node" parent="StateChart/ParallelState/Phase/Combat/Make Way/Choose Destination"]
script = ExtResource("23_hxj8n")
to = NodePath("../../../Resolve Combat/Resume Retreat")

[node name="StateChartDebugger" parent="." instance=ExtResource("26_5lf1w")]
layout_mode = 1
anchors_preset = 11
anchor_left = 1.0
offset_left = -505.0
offset_bottom = -129.0
grow_horizontal = 0
initial_node_to_watch = NodePath("../StateChart")

[connection signal="toggled" from="BottomLeftMargin/HBoxContainer/VBox/ToggleInstructions" to="BottomLeftMargin/HBoxContainer/VBox/Panel" method="set_visible"]
[connection signal="pressed" from="BottomRightMargin/HBox/Cancel/CancelMoverChoice" to="." method="__on_mover_choice_cancelled"]
[connection signal="pressed" from="BottomRightMargin/HBox/Cancel/CancelAttack" to="PlayStateMachine/CombatPhase/CombatPhaseStateMachine/ChooseUnitsForAttack" method="cancel_attack"]
[connection signal="pressed" from="BottomRightMargin/HBox/Cancel/ChangeAttackers" to="PlayStateMachine/CombatPhase/CombatPhaseStateMachine/ChooseDefenderForAttack" method="change_attackers"]
[connection signal="pressed" from="BottomRightMargin/HBox/Cancel/ChangeAttackerForRetreat" to="PlayStateMachine/CombatPhase/CombatPhaseStateMachine/RetreatAttacker" method="cancel_choice_of_retreater"]
[connection signal="pressed" from="BottomRightMargin/HBox/Cancel/UnitChosenToMakeWay" to="PlayStateMachine/CombatPhase/CombatPhaseStateMachine/ChooseAllyToMakeWay" method="cancel_choice_of_retreater"]
[connection signal="pressed" from="BottomRightMargin/HBox/Cancel/CancelPursuit" to="PlayStateMachine/CombatPhase/CombatPhaseStateMachine/ChooseAttackerToPursueRetreatingDefender" method="cancel"]
[connection signal="pressed" from="BottomRightMargin/HBox/Confirm/EndMovementPhase" to="." method="__on_movement_ended"]
[connection signal="pressed" from="BottomRightMargin/HBox/Confirm/EndCombatPhase" to="PlayStateMachine/CombatPhase" method="confirm_combat"]
[connection signal="pressed" from="BottomRightMargin/HBox/Confirm/ConfirmAttackers" to="PlayStateMachine/CombatPhase/CombatPhaseStateMachine/ChooseUnitsForAttack" method="confirm_attackers"]
[connection signal="pressed" from="BottomRightMargin/HBox/Confirm/ConfirmDefender" to="PlayStateMachine/CombatPhase/CombatPhaseStateMachine/ChooseDefenderForAttack" method="confirm_attack"]
[connection signal="pressed" from="BottomRightMargin/HBox/Confirm/ConfirmCombatResult" to="PlayStateMachine/CombatPhase/CombatPhaseStateMachine/ResolveCombat" method="__on_user_ok"]
[connection signal="pressed" from="BottomRightMargin/HBox/Confirm/ConfirmLossAllocation" to="PlayStateMachine/CombatPhase/CombatPhaseStateMachine/AllocateExchangeLosses" method="confirm_loss_allocation"]
[connection signal="duke_died" from="PlayStateMachine/CombatPhase" to="." method="__on_duke_death"]
[connection signal="last_turn_ended" from="PlayStateMachine/CombatPhase" to="." method="__on_last_turn_end"]
[connection signal="state_entered" from="StateChart/ParallelState/Player/Player 1" to="." method="__on_player_1_state_entered"]
[connection signal="state_entered" from="StateChart/ParallelState/Player/Player 2" to="." method="__on_player_2_state_entered"]
[connection signal="state_entered" from="StateChart/ParallelState/Phase/Movement" to="." method="__on_movement_state_entered"]
[connection signal="state_exited" from="StateChart/ParallelState/Phase/Movement" to="." method="__on_movement_state_exited"]
[connection signal="state_entered" from="StateChart/ParallelState/Phase/Movement/Choose Mover" to="." method="__on_choose_mover_state_entered"]
[connection signal="state_exited" from="StateChart/ParallelState/Phase/Movement/Choose Mover" to="." method="__on_choose_mover_state_exited"]
[connection signal="state_entered" from="StateChart/ParallelState/Phase/Movement/Choose Destination" to="." method="__on_choose_destination_state_entered"]
[connection signal="state_exited" from="StateChart/ParallelState/Phase/Movement/Choose Destination" to="." method="__on_choose_destination_state_exited"]
[connection signal="state_exited" from="StateChart/ParallelState/Phase/Combat" to="." method="__on_combat_state_exited"]
