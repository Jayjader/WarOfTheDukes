[gd_scene load_steps=7 format=3 uid="uid://bwst2xk4wn3l6"]

[ext_resource type="Script" path="res://BoardRoot.gd" id="1_r6u8w"]
[ext_resource type="Texture2D" uid="uid://dgr4iw8ue00sq" path="res://docs/La guerre des ducs - Encart.jpg" id="2_w7llp"]
[ext_resource type="Script" path="res://TileOverlay.gd" id="3_hyvcy"]
[ext_resource type="Script" path="res://Direct.gd" id="4_q436x"]
[ext_resource type="Script" path="res://Palette.gd" id="5_qxi0c"]
[ext_resource type="Script" path="res://MapDataSaveLoad.gd" id="6_m1yso"]

[node name="BoardRoot" type="Node2D"]
script = ExtResource("1_r6u8w")

[node name="MapDataSaveLoad" type="Node" parent="."]
script = ExtResource("6_m1yso")

[node name="Background" type="Sprite2D" parent="."]
self_modulate = Color(1, 1, 1, 0)
texture = ExtResource("2_w7llp")
centered = false

[node name="TileOverlay" type="Control" parent="Background"]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
script = ExtResource("3_hyvcy")
map_data = {}

[node name="UIRoot" type="Control" parent="."]
layout_mode = 3
anchors_preset = 0
offset_right = 1918.0
offset_bottom = 1076.0
mouse_filter = 2

[node name="Calibration" type="Panel" parent="UIRoot" groups=["map-edit-ui"]]
visible = false
layout_mode = 1
anchors_preset = -1
anchor_left = 0.3
anchor_right = 0.7
offset_left = 150.6
offset_top = 19.0
offset_right = -150.6
offset_bottom = 238.0
grow_horizontal = 2

[node name="EditControls" type="VBoxContainer" parent="UIRoot/Calibration"]
layout_mode = 1
anchors_preset = 5
anchor_left = 0.5
anchor_right = 0.5
offset_left = -205.5
offset_right = 205.5
offset_bottom = 101.0
grow_horizontal = 2

[node name="OriginControls" type="VBoxContainer" parent="UIRoot/Calibration/EditControls"]
layout_mode = 2

[node name="CalibrationMode" type="Label" parent="UIRoot/Calibration/EditControls/OriginControls"]
layout_mode = 2
horizontal_alignment = 1

[node name="Direct" type="HBoxContainer" parent="UIRoot/Calibration/EditControls/OriginControls"]
layout_mode = 2
script = ExtResource("4_q436x")

[node name="RestartCalibration" type="Button" parent="UIRoot/Calibration/EditControls/OriginControls/Direct"]
layout_mode = 2
text = "Restart Calibration"

[node name="Labels" type="HBoxContainer" parent="UIRoot/Calibration/EditControls/OriginControls/Direct"]
layout_mode = 2

[node name="Left" type="VBoxContainer" parent="UIRoot/Calibration/EditControls/OriginControls/Direct/Labels"]
layout_mode = 2

[node name="TopLeftLabel" type="Label" parent="UIRoot/Calibration/EditControls/OriginControls/Direct/Labels/Left"]
layout_mode = 2
text = "T-L: null"

[node name="BottomLeftLabel" type="Label" parent="UIRoot/Calibration/EditControls/OriginControls/Direct/Labels/Left"]
layout_mode = 2
text = "B-L: null"

[node name="Right" type="VBoxContainer" parent="UIRoot/Calibration/EditControls/OriginControls/Direct/Labels"]
layout_mode = 2

[node name="TopRightLabel" type="Label" parent="UIRoot/Calibration/EditControls/OriginControls/Direct/Labels/Right"]
layout_mode = 2
text = "T-R: null"

[node name="BottomRightLabel" type="Label" parent="UIRoot/Calibration/EditControls/OriginControls/Direct/Labels/Right"]
layout_mode = 2
text = "B-R: null"

[node name="ChangeCalibrationStep" type="VBoxContainer" parent="UIRoot/Calibration/EditControls/OriginControls/Direct"]
layout_mode = 2

[node name="Previous" type="Button" parent="UIRoot/Calibration/EditControls/OriginControls/Direct/ChangeCalibrationStep"]
layout_mode = 2
text = "Previous Step"

[node name="Next" type="Button" parent="UIRoot/Calibration/EditControls/OriginControls/Direct/ChangeCalibrationStep"]
layout_mode = 2
text = "Next Step"

[node name="TilesWideControls" type="HBoxContainer" parent="UIRoot/Calibration/EditControls"]
layout_mode = 2

[node name="Label" type="Label" parent="UIRoot/Calibration/EditControls/TilesWideControls"]
layout_mode = 2
text = "Tiles Wide:"
horizontal_alignment = 2

[node name="TilesWide" type="LineEdit" parent="UIRoot/Calibration/EditControls/TilesWideControls"]
layout_mode = 2

[node name="TilesHeighControls" type="HBoxContainer" parent="UIRoot/Calibration/EditControls"]
layout_mode = 2

[node name="Label" type="Label" parent="UIRoot/Calibration/EditControls/TilesHeighControls"]
layout_mode = 2
text = "Tiles Heigh:"
horizontal_alignment = 2

[node name="TilesHeigh" type="LineEdit" parent="UIRoot/Calibration/EditControls/TilesHeighControls"]
layout_mode = 2

[node name="SaveCalibrationData" type="Button" parent="UIRoot/Calibration/EditControls"]
layout_mode = 2
text = "Save Calibration Data"

[node name="Palette" type="Panel" parent="UIRoot" groups=["map-edit-ui"]]
visible = false
layout_mode = 0
offset_left = 1639.0
offset_top = 14.0
offset_right = 1900.0
offset_bottom = 694.0
script = ExtResource("5_qxi0c")
items = Array[String](["Plains", "City", "Forest", "Cliff", "Lake", "Fortress"])
borders = Array[String](["Road", "River", "Bridge", "Bridge (No Road)"])

[node name="Items" type="VBoxContainer" parent="UIRoot/Palette"]
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -101.0
offset_top = -103.0
offset_right = 101.0
offset_bottom = 103.0
grow_horizontal = 2
grow_vertical = 2

[node name="SaveMapData" type="Button" parent="UIRoot/Palette/Items"]
layout_mode = 2
text = "Save Map Data"

[node name="LoadMapData" type="Button" parent="UIRoot/Palette/Items"]
layout_mode = 2
text = "Load Map Data"

[node name="HSeparator" type="HSeparator" parent="UIRoot/Palette/Items"]
layout_mode = 2

[node name="Title" type="HBoxContainer" parent="UIRoot/Palette/Items"]
layout_mode = 2

[node name="Static" type="Label" parent="UIRoot/Palette/Items/Title"]
layout_mode = 2
text = "Selected:"

[node name="Selected" type="Label" parent="UIRoot/Palette/Items/Title"]
layout_mode = 2

[node name="Button" type="Button" parent="UIRoot/Palette/Items"]
layout_mode = 2
text = "Clear Selection"

[node name="HSeparator2" type="HSeparator" parent="UIRoot/Palette/Items"]
layout_mode = 2

[node name="Tiles" type="VBoxContainer" parent="UIRoot/Palette/Items"]
layout_mode = 2

[node name="Title" type="Label" parent="UIRoot/Palette/Items/Tiles"]
layout_mode = 2
text = "Tiles"

[node name="Erase" type="Button" parent="UIRoot/Palette/Items/Tiles"]
layout_mode = 2
text = "Erase Tile"

[node name="HSeparator3" type="HSeparator" parent="UIRoot/Palette/Items"]
layout_mode = 2

[node name="Borders" type="VBoxContainer" parent="UIRoot/Palette/Items"]
layout_mode = 2

[node name="Title" type="Label" parent="UIRoot/Palette/Items/Borders"]
layout_mode = 2
text = "Borders"

[node name="Erase" type="Button" parent="UIRoot/Palette/Items/Borders"]
layout_mode = 2
text = "Erase Border"

[connection signal="data_load_requested" from="." to="MapDataSaveLoad" method="load_data"]
[connection signal="data_saved" from="." to="MapDataSaveLoad" method="save_data"]
[connection signal="data_loaded" from="MapDataSaveLoad" to="." method="_on_map_data_load"]
[connection signal="bl_set" from="Background/TileOverlay" to="UIRoot/Calibration/EditControls/OriginControls/Direct" method="on_bl_set"]
[connection signal="br_set" from="Background/TileOverlay" to="UIRoot/Calibration/EditControls/OriginControls/Direct" method="on_br_set"]
[connection signal="calibration_mode_entered" from="Background/TileOverlay" to="UIRoot/Calibration/EditControls/OriginControls/CalibrationMode" method="set_text"]
[connection signal="tl_set" from="Background/TileOverlay" to="UIRoot/Calibration/EditControls/OriginControls/Direct" method="on_tl_set"]
[connection signal="tr_set" from="Background/TileOverlay" to="UIRoot/Calibration/EditControls/OriginControls/Direct" method="on_tr_set"]
[connection signal="pressed" from="UIRoot/Calibration/EditControls/OriginControls/Direct/RestartCalibration" to="Background/TileOverlay" method="start_calibration"]
[connection signal="pressed" from="UIRoot/Calibration/EditControls/OriginControls/Direct/ChangeCalibrationStep/Previous" to="Background/TileOverlay" method="previous_calibration_step"]
[connection signal="pressed" from="UIRoot/Calibration/EditControls/OriginControls/Direct/ChangeCalibrationStep/Next" to="Background/TileOverlay" method="next_calibration_step"]
[connection signal="text_changed" from="UIRoot/Calibration/EditControls/TilesWideControls/TilesWide" to="Background/TileOverlay" method="choose_tiles_wide"]
[connection signal="text_changed" from="UIRoot/Calibration/EditControls/TilesHeighControls/TilesHeigh" to="Background/TileOverlay" method="choose_tiles_heigh"]
[connection signal="pressed" from="UIRoot/Calibration/EditControls/SaveCalibrationData" to="Background/TileOverlay" method="save_calibration_data"]
[connection signal="palette_border_selected" from="UIRoot/Palette" to="Background/TileOverlay" method="change_paint_selection" binds= [false]]
[connection signal="palette_selection_cleared" from="UIRoot/Palette" to="Background/TileOverlay" method="change_paint_selection" binds= [""]]
[connection signal="palette_tile_selected" from="UIRoot/Palette" to="Background/TileOverlay" method="change_paint_selection"]
[connection signal="pressed" from="UIRoot/Palette/Items/SaveMapData" to="." method="_on_map_data_save"]
[connection signal="pressed" from="UIRoot/Palette/Items/LoadMapData" to="MapDataSaveLoad" method="load_data"]
[connection signal="pressed" from="UIRoot/Palette/Items/Button" to="UIRoot/Palette" method="clear_selection"]
[connection signal="pressed" from="UIRoot/Palette/Items/Tiles/Erase" to="UIRoot/Palette" method="change_selection" binds= ["erase-tile"]]
[connection signal="pressed" from="UIRoot/Palette/Items/Borders/Erase" to="UIRoot/Palette" method="change_selection" binds= ["erase-border"]]
